### データベース接続

```
psql -U postgres -d postgres
psql -U health -d healthes
```

### ロール（ユーザー）の作成

```
CREATE ROLE health WITH
  LOGIN
    NOSUPERUSER
    NOCREATEDB
    NOCREATEROLE
    INHERIT
    NOREPLICATION
    CONNECTION LIMIT -1
    PASSWORD 'health';
```

### データベースの作成

```
CREATE DATABASE healthes
    WITH
    TEMPLATE = template0
    OWNER = health
    ENCODING = 'UTF8'
    LC_COLLATE = 'ja_JP.UTF-8'
    LC_CTYPE = 'ja_JP.UTF-8'
    CONNECTION LIMIT = -1;
```

### パブリックスキーマの作成

```
\c healthes
DROP SCHEMA public cascade;
CREATE SCHEMA public;
ALTER SCHEMA public owner to health;
```

### 権限の付与

```
GRANT SELECT, INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA public TO health;
```

### テーブルの作成

#### employees

```
CREATE TABLE employees (
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    bu text NULL,
    ka text NULL,
    rank text NULL,
    no text NOT NULL,
    name text NOT NULL,
    CONSTRAINT "PK_employees" PRIMARY KEY (id)
);
```

#### conditions

```
CREATE TABLE conditions (
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    name text NOT NULL,
    CONSTRAINT "PK_conditions" PRIMARY KEY (id)
);
```

#### holidays

```
CREATE TABLE holidays (
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    date date NOT NULL,
    name text NOT NULL,
    CONSTRAINT "PK_holidays" PRIMARY KEY (id)
);
```

#### reports

```
CREATE TABLE reports (
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    employee_id integer NOT NULL,
    date timestamp without time zone NOT NULL,
    condition_id integer NOT NULL,
    reason text NULL,
    CONSTRAINT "PK_reports" PRIMARY KEY (id),
    CONSTRAINT "FK_reports_employees_employee_id"
        FOREIGN KEY (employee_id)
        REFERENCES employees (id) ON DELETE CASCADE,
    CONSTRAINT "FK_reports_conditions_condition_id"
        FOREIGN KEY (condition_id)
        REFERENCES conditions (id) ON DELETE CASCADE,
    CONSTRAINT "U_reports" UNIQUE (employee_id, date)
);
```

### やり直したくなったら･･･

```
drop database healthes;
drop role health;
```

### データベースのバクアップを取る

```
pg_dump -U health -d healthes -Fc -v -f /dump/`date '+%Y%m%d%H%M%s'`.dump
```

### バクアップをリストアする

```
pg_restore -U health -d healthes -v -c --if-exists /dump/2021121403161639451762.dump
```
